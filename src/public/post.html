<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Post</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="index.html">← Powrót</a>
  <h1 id="postTitle"></h1>
  <p id="postBody"></p>

  <div class="comments-section">
    <h3>Komentarze</h3>
    <ul id="comments"></ul>
  </div>

  <div class="comment-form-section">
  <h3>Dodaj komentarz</h3>
  <form id="commentForm" class="comment-form">
    <label for="author">Autor:</label>
    <input id="author" type="text">

    <label for="commentBody">Komentarz:</label>
    <textarea id="commentBody"></textarea>

    <button>Dodaj komentarz</button>
  </form>
  </div>

  <script>
    const API = "/api";
    const url = new URL(location.href);
    const id = url.searchParams.get("id");

    async function loadPost() {
      const res = await fetch(`${API}/posts`);
      const posts = await res.json();
      const post = posts.find(p => p.id == id);

      document.getElementById("postTitle").textContent = post.title;
      document.getElementById("postBody").textContent = post.body;
    }

    async function loadComments() {
      const res = await fetch(`${API}/posts/${id}/comments`);
      const comments = await res.json();

      const ul = document.getElementById("comments");
      ul.innerHTML = "";

    //   comments.forEach(c => {
    //     ul.innerHTML += `<li><strong>${c.author}</strong>: ${c.body}</li>`;
    //   });
        comments.forEach(c => {
        const li = document.createElement("li");
        li.classList.add("comment");
        li.innerHTML = `
            <div class="comment-author">${c.author}</div>
            <div class="comment-body">${c.body}</div>
        `;
        ul.appendChild(li);
        });
    }

    document.getElementById("commentForm").addEventListener("submit", async e => {
      e.preventDefault();
      const author = document.getElementById("author").value;
      const body = document.getElementById("commentBody").value;

      await fetch(`${API}/comments/post/${id}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ author, body })
      });

      alert("Komentarz dodany — oczekuje na moderację.");
      e.target.reset();
    });

    loadPost();
    loadComments();
    setInterval(loadComments, 2000);
  </script>
</body>
</html>
