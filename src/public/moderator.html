<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel moderatora</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <a href="index.html" class="back-link">← Powrót do bloga</a>
  <h1>Panel moderatora</h1>

  <div class="section">
    <h2>Komentarze oczekujące na zatwierdzenie</h2>
    <ul id="pendingComments"></ul>
  </div>

  <script>
    const API = "/api";

    async function loadPending() {
      const res = await fetch(`${API}/comments/pending`);
      const comments = await res.json();

      const ul = document.getElementById("pendingComments");
      ul.innerHTML = "";

      if (comments.length === 0) {
        ul.innerHTML = "<li>Brak komentarzy do zatwierdzenia.</li>";
        return;
      }

      comments.forEach(c => {
        const li = document.createElement("li");

        li.innerHTML = `
          <strong>${c.author}</strong> komentuje post:
          <em>${c.post.title}</em><br>
          ${c.body}<br>
          <button data-id="${c.id}" class="approve-btn">Zatwierdź</button>
        `;

        ul.appendChild(li);
      });

      document.querySelectorAll(".approve-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          const id = btn.dataset.id;

          await fetch(`${API}/comments/${id}/approve`, {
            method: "POST"
          });

          loadPending(); // odśwież listę
        });
      });
    }

    loadPending();
    setInterval(loadPending, 3000); // odśwież co 3 sekundy
  </script>

</body>
</html>
